<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>–ú–∞–ª–æ–†–∏—Å–∞ ‚Äî –ó–º–µ–π–∫–∞</title>

<style>
:root{
  --bg:#0f0f0f;
  --panel:#1a1a1a;
  --canvas:#000;
  --text:#fff;
  --accent:#ff6b9a;
}
body.light{
  --bg:#f4f4f4;
  --panel:#ffffff;
  --canvas:#eaeaea;
  --text:#111;
}

*{margin:0;padding:0;box-sizing:border-box}
body{
  background:var(--bg);
  color:var(--text);
  font-family:system-ui, sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  height:100vh;
  touch-action:none;
}

header{
  width:100%;
  padding:12px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:var(--panel);
}

.title{
  color:var(--accent);
  font-size:18px;
  font-weight:700;
}

.toggle{
  font-size:14px;
  padding:6px 10px;
  border-radius:10px;
  background:#2a2a2a;
  color:#fff;
}
body.light .toggle{background:#ddd;color:#000}

canvas{
  background:var(--canvas);
  border-radius:18px;
  margin:12px 0;
}

.controls{
  display:grid;
  grid-template-columns:repeat(3,70px);
  grid-template-rows:repeat(2,70px);
  gap:10px;
}
.btn{
  background:#2a2a2a;
  border-radius:18px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:28px;
  color:#fff;
}
body.light .btn{background:#ddd;color:#000}
.btn:active{background:var(--accent)}
.up{grid-column:2}
.left{grid-column:1}
.down{grid-column:2}
.right{grid-column:3}
</style>
</head>

<body>

<header>
  <div id="score">0</div>
  <div class="title">–ú–∞–ª–æ–†–∏—Å–∞</div>
  <div style="display:flex;gap:8px;align-items:center">
    <div id="record">0</div>
    <div class="toggle" id="themeBtn">‚òÄÔ∏é / üåô</div>
  </div>
</header>

<canvas id="game" width="320" height="320"></canvas>

<div class="controls">
  <div></div><div class="btn up">‚ñ≤</div><div></div>
  <div class="btn left">‚óÄ</div><div class="btn down">‚ñº</div><div class="btn right">‚ñ∂</div>
</div>

<script>
const canvas = document.getElementById("game")
const ctx = canvas.getContext("2d")

const CELL = 20
const SPEED = 2.3
const foods = ["üç£","üçü","üçî","üçï"]

let snake, dir, nextDir, food, score
let record = localStorage.getItem("malorisa_record") || 0
document.getElementById("record").innerText = record

function start(){
  snake = [{x:160,y:160}]
  dir = {x:1,y:0}
  nextDir = dir
  score = 0
  document.getElementById("score").innerText = score
  spawnFood()
}
start()

function spawnFood(){
  food = {
    x:Math.floor(Math.random()*16)*CELL,
    y:Math.floor(Math.random()*16)*CELL,
    icon:foods[Math.floor(Math.random()*foods.length)]
  }
}

function update(){
  dir = nextDir
  const head = {
    x:snake[0].x + dir.x*SPEED,
    y:snake[0].y + dir.y*SPEED
  }

  if(head.x<0) head.x=canvas.width-CELL
  if(head.y<0) head.y=canvas.height-CELL
  if(head.x>=canvas.width) head.x=0
  if(head.y>=canvas.height) head.y=0

  snake.unshift(head)

  if(Math.abs(head.x-food.x)<CELL/2 && Math.abs(head.y-food.y)<CELL/2){
    score++
    document.getElementById("score").innerText = score
    spawnFood()
  }else{
    snake.pop()
  }

  for(let i=4;i<snake.length;i++){
    if(Math.abs(head.x-snake[i].x)<10 && Math.abs(head.y-snake[i].y)<10){
      if(score>record){
        record=score
        localStorage.setItem("malorisa_record",record)
      }
      document.getElementById("record").innerText=record
      start()
      break
    }
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height)

  // –µ–¥–∞
  ctx.font="18px serif"
  ctx.fillText(food.icon, food.x+2, food.y+18)

  // —Ç–µ–ª–æ
  for(let i=snake.length-1;i>0;i--){
    ctx.fillStyle="#3aa84a"
    ctx.beginPath()
    ctx.roundRect(snake[i].x, snake[i].y, CELL-3, CELL-3, 6)
    ctx.fill()
  }

  // –≥–æ–ª–æ–≤–∞
  const h = snake[0]
  ctx.fillStyle="#2ecc71"
  ctx.beginPath()
  ctx.arc(h.x+CELL/2-2, h.y+CELL/2-2, CELL/2, 0, Math.PI*2)
  ctx.fill()

  // —á–µ—à—É–π–∫–∏
  ctx.fillStyle="rgba(255,255,255,0.25)"
  for(let i=0;i<6;i++){
    ctx.beginPath()
    ctx.arc(
      h.x+6+(i%3)*6,
      h.y+6+Math.floor(i/3)*6,
      2,0,Math.PI*2
    )
    ctx.fill()
  }
}

function loop(){
  update()
  draw()
  requestAnimationFrame(loop)
}
loop()

function setDir(x,y){
  if(dir.x!==-x && dir.y!==-y){
    nextDir={x,y}
  }
}

document.querySelector(".up").onclick=()=>setDir(0,-1)
document.querySelector(".down").onclick=()=>setDir(0,1)
document.querySelector(".left").onclick=()=>setDir(-1,0)
document.querySelector(".right").onclick=()=>setDir(1,0)

// —Å–≤–∞–π–ø—ã
let sx,sy
canvas.addEventListener("touchstart",e=>{
  sx=e.touches[0].clientX
  sy=e.touches[0].clientY
})
canvas.addEventListener("touchend",e=>{
  let dx=e.changedTouches[0].clientX-sx
  let dy=e.changedTouches[0].clientY-sy
  Math.abs(dx)>Math.abs(dy)
    ? setDir(dx>0?1:-1,0)
    : setDir(0,dy>0?1:-1)
})

// —Ç–µ–º–∞
document.getElementById("themeBtn").onclick=()=>{
  document.body.classList.toggle("light")
}
</script>

</body>
</html>
