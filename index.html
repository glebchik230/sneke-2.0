<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>–ú–∞–ª–æ–†–∏—Å–∞ ‚Äî –ó–º–µ–π–∫–∞</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#111;
  --panel:#1c1c1c;
  --canvas:#000;
  --text:#fff;
  --accent:#ff6b9a;
}
body.light{
  --bg:#f3f3f3;
  --panel:#fff;
  --canvas:#e6e6e6;
  --text:#111;
}

*{margin:0;padding:0;box-sizing:border-box}
body{
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  height:100vh;
  touch-action:none;
}

header{
  width:100%;
  padding:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:var(--panel);
}

.title{
  font-family:'Press Start 2P', monospace;
  font-size:14px;
  color:var(--accent);
}

.btn-ui{
  font-size:14px;
  padding:6px 10px;
  border-radius:10px;
  background:#2a2a2a;
  color:#fff;
}
body.light .btn-ui{background:#ddd;color:#000}

canvas{
  background:var(--canvas);
  border-radius:12px;
  margin:10px 0;
}

.controls{
  display:grid;
  grid-template-columns:repeat(3,70px);
  grid-template-rows:repeat(2,70px);
  gap:10px;
}
.btn{
  background:#222;
  border-radius:14px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:28px;
}
body.light .btn{background:#ddd;color:#000}
.btn:active{background:var(--accent)}
.up{grid-column:2}
.left{grid-column:1}
.down{grid-column:2}
.right{grid-column:3}

.overlay{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:10;
}

.logo{
  font-family:'Press Start 2P', monospace;
  font-size:24px;
  color:var(--accent);
  animation:float 2.5s ease-in-out infinite;
  margin-bottom:30px;
}

@keyframes float{
  0%{transform:translateY(0)}
  50%{transform:translateY(-12px)}
  100%{transform:translateY(0)}
}

.pixel-btn{
  font-family:'Press Start 2P', monospace;
  font-size:14px;
  padding:16px 28px;
  border-radius:14px;
  background:var(--accent);
  color:#000;
  margin-top:16px;
}

/* —É–º–µ–Ω—å—à–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
.pixel-btn.small{
  font-size:10px;
  padding:10px 18px;
  opacity:.9;
}

.gameover{
  font-family:'Press Start 2P', monospace;
  font-size:18px;
  margin-bottom:16px;
}
.small{font-size:12px}
</style>
</head>

<body>

<!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
<div class="overlay" id="startScreen">
  <div class="logo">–ú–ê–õ–û–†–ò–°–ê</div>
  <div class="pixel-btn" id="playBtn">–ò–ì–†–ê–¢–¨</div>
  <div class="pixel-btn small" id="inviteBtn">–ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê</div>
</div>

<!-- Game Over -->
<div class="overlay" id="gameOverScreen" style="display:none">
  <div class="gameover">GAME OVER</div>
  <div class="small">
    –°—á–µ—Ç: <span id="finalScore">0</span> |
    –†–µ–∫–æ—Ä–¥: <span id="finalRecord">0</span>
  </div>
  <div class="pixel-btn" id="restartBtn">–°–ù–û–í–ê</div>
  <div class="pixel-btn small" id="exitBtn">–í –ú–ï–ù–Æ</div>
</div>

<header>
  <span id="score">0</span>
  <span class="title">–ú–ê–õ–û–†–ò–°–ê</span>
  <span style="display:flex;gap:6px">
    <span id="record">0</span>
    <span class="btn-ui" id="pauseBtn">‚è∏</span>
    <span class="btn-ui" id="menuBtn">‚èÆ</span>
    <span class="btn-ui" id="themeBtn">‚òÄÔ∏é / üåô</span>
  </span>
</header>

<canvas id="game" width="320" height="320"></canvas>

<div class="controls">
  <div></div><div class="btn up">‚ñ≤</div><div></div>
  <div class="btn left">‚óÄ</div><div class="btn down">‚ñº</div><div class="btn right">‚ñ∂</div>
</div>

<script>
const canvas=document.getElementById("game")
const ctx=canvas.getContext("2d")
const box=20, cols=16, rows=16

const colors=["#ff6b9a","#6bffb0","#6bd4ff","#ffe66b","#c77dff"]

let snake,dir,food,score,paused=true
let record=localStorage.getItem("malorisa_record")||0

document.getElementById("record").innerText=record
document.getElementById("finalRecord").innerText=record

const foods=["üç£","üçü","üçî","üçï"]
const audioCtx=new (window.AudioContext||window.webkitAudioContext)()

function randColor(){
  return colors[Math.floor(Math.random()*colors.length)]
}

function beep(f=600,t=0.1){
  const o=audioCtx.createOscillator(),g=audioCtx.createGain()
  o.type="square";o.frequency.value=f
  g.gain.value=0.08;o.connect(g).connect(audioCtx.destination)
  o.start();o.stop(audioCtx.currentTime+t)
}

function start(){
  snake=[{x:8,y:8,color:randColor()}]
  dir={x:1,y:0}
  score=0
  paused=false
  document.getElementById("score").innerText=0
  spawnFood()
}

function spawnFood(){
  food={
    x:Math.floor(Math.random()*cols),
    y:Math.floor(Math.random()*rows),
    icon:foods[Math.floor(Math.random()*foods.length)]
  }
}

function gameOver(){
  paused=true
  if(score>record){
    record=score
    localStorage.setItem("malorisa_record",record)
  }
  document.getElementById("finalScore").innerText=score
  document.getElementById("finalRecord").innerText=record
  document.getElementById("record").innerText=record
  document.getElementById("gameOverScreen").style.display="flex"
}

function update(){
  if(paused) return

  const head={
    x:(snake[0].x+dir.x+cols)%cols,
    y:(snake[0].y+dir.y+rows)%rows,
    color:snake[0].color
  }

  if(snake.some(p=>p.x===head.x&&p.y===head.y)) return gameOver()

  snake.unshift(head)

  if(head.x===food.x&&head.y===food.y){
    score++
    snake[0].color=randColor()
    document.getElementById("score").innerText=score
    beep(900)
    spawnFood()
  }else{
    snake.pop()
  }
}

function draw(){
  ctx.fillStyle=getComputedStyle(document.body).getPropertyValue('--canvas')
  ctx.fillRect(0,0,320,320)

  ctx.font="18px serif"
  ctx.fillText(food.icon,food.x*box+2,food.y*box+18)

  snake.forEach(p=>{
    ctx.fillStyle=p.color
    ctx.fillRect(p.x*box,p.y*box,box-2,box-2)
  })
}

setInterval(()=>{update();draw()},150)

function setDir(x,y){
  if(!paused&&!(dir.x===-x&&dir.y===-y)) dir={x,y}
}

document.querySelector(".up").onclick=()=>setDir(0,-1)
document.querySelector(".down").onclick=()=>setDir(0,1)
document.querySelector(".left").onclick=()=>setDir(-1,0)
document.querySelector(".right").onclick=()=>setDir(1,0)

document.getElementById("pauseBtn").onclick=()=>paused=!paused
document.getElementById("themeBtn").onclick=()=>document.body.classList.toggle("light")

function exitToMenu(){
  paused=true
  document.getElementById("gameOverScreen").style.display="none"
  document.getElementById("startScreen").style.display="flex"
}

document.getElementById("menuBtn").onclick=exitToMenu
document.getElementById("exitBtn").onclick=exitToMenu

document.getElementById("playBtn").onclick=()=>{
  document.getElementById("startScreen").style.display="none"
  beep(500)
  start()
}

document.getElementById("restartBtn").onclick=()=>{
  document.getElementById("gameOverScreen").style.display="none"
  beep(500)
  start()
}

document.getElementById("inviteBtn").onclick=async()=>{
  const link=location.href
  if(navigator.share){
    navigator.share({title:"–ú–∞–ª–æ–†–∏—Å–∞",text:"–ü–æ–±–µ–π –º–æ–π —Ä–µ–∫–æ—Ä–¥!",url:link})
  }else{
    await navigator.clipboard.writeText(link)
    alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞")
  }
}
</script>

</body>
</html>
