<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>–ú–∞–ª–æ–†–∏—Å–∞ ‚Äî –ó–º–µ–π–∫–∞</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#111; --panel:#1c1c1c; --canvas:#000; --text:#fff; --accent:#ff6b9a;
}
body.light{
  --bg:#f3f3f3; --panel:#fff; --canvas:#e6e6e6; --text:#111;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:var(--bg); color:var(--text);
  font-family:system-ui,sans-serif;
  display:flex; flex-direction:column; align-items:center;
  height:100vh; touch-action:none;
}
header{
  width:100%; padding:12px;
  display:flex; justify-content:space-between; align-items:center;
  background:var(--panel);
}
.title{
  font-family:'Press Start 2P'; font-size:14px; color:var(--accent);
}
.btn-ui{
  font-size:14px; padding:6px 10px; border-radius:10px;
  background:#2a2a2a; color:#fff;
}
body.light .btn-ui{background:#ddd;color:#000}
canvas{background:var(--canvas); border-radius:12px; margin:10px 0}
.controls{
  display:grid; grid-template-columns:repeat(3,70px);
  grid-template-rows:repeat(2,70px); gap:10px;
}
.btn{
  background:#222; border-radius:14px;
  display:flex; justify-content:center; align-items:center;
  font-size:28px;
}
body.light .btn{background:#ddd;color:#000}
.btn:active{background:var(--accent)}
.up{grid-column:2}
.left{grid-column:1}
.down{grid-column:2}
.right{grid-column:3}
.overlay{
  position:fixed; inset:0; background:var(--bg);
  display:flex; flex-direction:column;
  justify-content:center; align-items:center; z-index:10;
}
.logo{
  font-family:'Press Start 2P'; font-size:24px;
  color:var(--accent); margin-bottom:30px;
}
.pixel-btn{
  font-family:'Press Start 2P'; font-size:14px;
  padding:16px 28px; border-radius:14px;
  background:var(--accent); color:#000; margin-top:14px;
}
.pixel-btn.small{font-size:10px;padding:8px 16px}
</style>
</head>

<body>

<div class="overlay" id="startScreen">
  <div class="logo">–ú–ê–õ–û–†–ò–°–ê</div>
  <div class="pixel-btn" id="playBtn">–ò–ì–†–ê–¢–¨</div>
  <div class="pixel-btn small" id="inviteBtn">–ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê</div>
</div>

<div class="overlay" id="gameOverScreen" style="display:none">
  <div class="logo">GAME OVER</div>
  <div id="finalInfo"></div>
  <div class="pixel-btn" id="restartBtn">–°–ù–û–í–ê</div>
  <div class="pixel-btn small" id="saveBtn" style="display:none">–°–û–•–†–ê–ù–ò–¢–¨ –†–ï–ö–û–†–î</div>
  <div class="pixel-btn small" id="exitBtn">–í –ú–ï–ù–Æ</div>
</div>

<header>
  <span id="score">0</span>
  <span class="title">–ú–ê–õ–û–†–ò–°–ê</span>
  <span style="display:flex;gap:6px">
    <span id="record">0</span>
    <span class="btn-ui" id="pauseBtn">‚è∏</span>
    <span class="btn-ui" id="menuBtn">‚èÆ</span>
  </span>
</header>

<canvas id="game" width="320" height="320"></canvas>

<div class="controls">
  <div></div><div class="btn up" onclick="setDir(0,-1)">‚ñ≤</div><div></div>
  <div class="btn left" onclick="setDir(-1,0)">‚óÄ</div>
  <div class="btn" onclick="setDir(0,1)">‚ñº</div>
  <div class="btn right" onclick="setDir(1,0)">‚ñ∂</div>
</div>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d")
const box=20,cols=16,rows=16
let snake,dir,food,score,paused=true
let speed=150,interval
let record=+localStorage.getItem("record")||0
let goldMode=false

const COLORS=["#ff6b9a","#6bffb0","#6bd4ff","#ffe66b"]
const GOLD="#ffd700"

document.getElementById("record").innerText=record

function randColor(){return COLORS[Math.floor(Math.random()*COLORS.length)]}

function start(){
  snake=[{x:8,y:8,color:randColor()}]
  dir={x:1,y:0}; score=0; speed=150; goldMode=false
  document.getElementById("score").innerText=0
  spawnFood(); paused=false
  clearInterval(interval)
  interval=setInterval(loop,speed)
}

function spawnFood(){
  const r=Math.random()
  food={
    x:Math.random()*cols|0,
    y:Math.random()*rows|0,
    type:r<0.15?"special":"normal",
    icon:r<0.05?"‚ö°":r<0.1?"üê¢":r<0.15?"‚≠ê":"üç£"
  }
}

function applyEffect(){
  if(food.icon==="‚ö°"){speed=80}
  if(food.icon==="üê¢"){speed=220}
  if(food.icon==="‚≠ê"){goldMode=true;setTimeout(()=>goldMode=false,5000)}
  clearInterval(interval)
  interval=setInterval(loop,speed)
}

function loop(){
  if(paused)return

  let isGold = Math.random()<0.1 || goldMode
  const h={
    x:(snake[0].x+dir.x+cols)%cols,
    y:(snake[0].y+dir.y+rows)%rows,
    color:isGold?GOLD:randColor()
  }

  if(snake.some(p=>p.x===h.x && p.y===h.y)) return gameOver()
  snake.unshift(h)

  if(h.x===food.x && h.y===food.y){
    score += isGold?3:1
    document.getElementById("score").innerText=score
    if(food.type==="special") applyEffect()
    spawnFood()
  } else {
    snake.pop()
  }

  draw()
}

function draw(){
  ctx.fillStyle="#000"; ctx.fillRect(0,0,320,320)
  ctx.font="18px serif"
  ctx.fillText(food.icon,food.x*box+2,food.y*box+18)
  snake.forEach(p=>{
    ctx.fillStyle=p.color
    ctx.fillRect(p.x*box,p.y*box,box-2,box-2)
  })
}

function gameOver(){
  paused=true; clearInterval(interval)
  let newRec=score>record
  if(newRec){record=score;localStorage.setItem("record",record)}
  document.getElementById("record").innerText=record
  document.getElementById("finalInfo").innerText=`–°–ß–Å–¢: ${score} | –†–ï–ö–û–†–î: ${record}`
  document.getElementById("saveBtn").style.display=newRec?"block":"none"
  document.getElementById("gameOverScreen").style.display="flex"
}

function setDir(x,y){
  if(!(dir.x===-x&&dir.y===-y))dir={x,y}
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ —Å —Ä–µ–∫–æ—Ä–¥–æ–º –∏ –ª–æ–≥–æ—Ç–∏–ø–æ–º
document.getElementById("saveBtn").onclick = () => {
  const tempCanvas = document.createElement("canvas");
  tempCanvas.width = canvas.width;
  tempCanvas.height = canvas.height + 60; // –º–µ—Å—Ç–æ –¥–ª—è —Ç–µ–∫—Å—Ç–∞
  const tctx = tempCanvas.getContext("2d");

  // —Ñ–æ–Ω
  tctx.fillStyle = "#000";
  tctx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);

  // —Ä–∏—Å—É–µ–º –∑–º–µ–π–∫—É
  snake.forEach(p => {
    tctx.fillStyle = p.color;
    tctx.fillRect(p.x * box, p.y * box + 60, box - 2, box - 2);
  });

  // —Ä–∏—Å—É–µ–º –µ–¥—É
  tctx.font = "18px serif";
  tctx.fillText(food.icon, food.x * box + 2, food.y * box + 18 + 60);

  // –Ω–∞–¥–ø–∏—Å—å –ú–ê–õ–û–†–ò–°–ê
  tctx.fillStyle = "#ff6b9a";
  tctx.font = "24px 'Press Start 2P'";
  tctx.textAlign = "center";
  tctx.fillText("–ú–ê–õ–û–†–ò–°–ê", tempCanvas.width / 2, 30);

  // —Ä–µ–∫–æ—Ä–¥
  tctx.fillStyle = "#fff";
  tctx.font = "18px 'Press Start 2P'";
  tctx.fillText(`–°–ß–Å–¢: ${score} | –†–ï–ö–û–†–î: ${record}`, tempCanvas.width / 2, 55);

  // —Å–æ—Ö—Ä–∞–Ω—è–µ–º
  const link = document.createElement("a");
  link.download = "malorisa-record.png";
  link.href = tempCanvas.toDataURL();
  link.click();
};

document.getElementById("menuBtn").onclick=exit
document.getElementById("exitBtn").onclick=exit
function exit(){
  paused=true
  document.getElementById("gameOverScreen").style.display="none"
  document.getElementById("startScreen").style.display="flex"
}

document.getElementById("playBtn").onclick=()=>{
  document.getElementById("startScreen").style.display="none"
  start()
}

document.getElementById("restartBtn").onclick=()=>{
  document.getElementById("gameOverScreen").style.display="none"
  start()
}

document.getElementById("inviteBtn").onclick=()=>{
  navigator.share?.({title:"–ú–∞–ª–æ–†–∏—Å–∞",text:"–ü–æ–±–µ–π –º–æ–π —Ä–µ–∫–æ—Ä–¥!",url:location.href})
}
</script>
</body>
</html>

