<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>МалоРиса — Змейка</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#111;
  --panel:#1c1c1c;
  --canvas:#000;
  --text:#fff;
  --accent:#ff6b9a;
}

*{margin:0;padding:0;box-sizing:border-box}
body{
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  height:100vh;
}

header{
  width:100%;
  padding:12px;
  display:flex;
  justify-content:space-between;
  background:var(--panel);
}

canvas{
  background:var(--canvas);
  border-radius:12px;
  margin:10px 0;
}

.overlay{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:10;
}

.pixel-btn{
  font-family:'Press Start 2P';
  padding:14px 24px;
  border-radius:14px;
  background:var(--accent);
  color:#000;
  margin-top:12px;
  cursor:pointer;
}

.small{font-size:11px;padding:10px 18px}

.shop{
  margin-top:20px;
  text-align:center;
}

.skin{
  border:2px solid #333;
  padding:10px;
  margin-top:8px;
  border-radius:10px;
  cursor:pointer;
}

.skin.active{border-color:var(--accent)}

</style>
</head>

<body>

<div class="overlay" id="startScreen">
  <h2>МАЛОРИСА</h2>

  <div class="shop">
    <b>Скины головы</b>

    <div class="skin active" data-skin="default">Обычная (бесплатно)</div>
    <div class="skin" data-skin="gold">Золотая — 15 очков</div>
    <div class="skin" data-skin="neon">Неон — 30 очков</div>
    <div class="skin" data-skin="ruby">Рубин — 50 очков</div>
  </div>

  <div class="pixel-btn" id="playBtn">ИГРАТЬ</div>

  <div style="margin-top:20px;font-size:12px">
    <b>Рекорды</b>
    <ol id="records"></ol>
  </div>
</div>

<header>
  <span id="score">0</span>
  <span>МАЛОРИСА</span>
  <span id="record">0</span>
</header>

<canvas id="game" width="320" height="320"></canvas>

<script>
const canvas=document.getElementById("game")
const ctx=canvas.getContext("2d")
const box=20, cols=16, rows=16

let snake,dir,food,score,paused=true
let selectedSkin=localStorage.getItem("headSkin")||"default"

const skins={
  default:"#ff6b9a",
  gold:"#ffd700",
  neon:"#00ffe7",
  ruby:"#ff2d55"
}

let records=JSON.parse(localStorage.getItem("records"))||[
  {name:"Глеб",score:40},
  {name:"Аня",score:30},
  {name:"Макс",score:20}
]

function saveRecords(){
  localStorage.setItem("records",JSON.stringify(records))
}

function renderRecords(){
  const list=document.getElementById("records")
  list.innerHTML=""
  records.forEach(r=>{
    const li=document.createElement("li")
    li.textContent=`${r.name} — ${r.score}`
    list.appendChild(li)
  })
}
renderRecords()

document.querySelectorAll(".skin").forEach(el=>{
  el.onclick=()=>{
    const skin=el.dataset.skin
    const cost={default:0,gold:15,neon:30,ruby:50}[skin]
    if(cost>localStorage.getItem("totalScore")-0){
      alert("Недостаточно очков")
      return
    }
    selectedSkin=skin
    localStorage.setItem("headSkin",skin)
    document.querySelectorAll(".skin").forEach(s=>s.classList.remove("active"))
    el.classList.add("active")
  }
})

function start(){
  snake=[{x:8,y:8}]
  dir={x:1,y:0}
  score=0
  paused=false
  spawnFood()
}

function spawnFood(){
  food={
    x:Math.floor(Math.random()*cols),
    y:Math.floor(Math.random()*rows)
  }
}

function gameOver(){
  paused=true
  let total=localStorage.getItem("totalScore")-0||0
  total+=score
  localStorage.setItem("totalScore",total)

  records.push({name:"Ты",score})
  records.sort((a,b)=>b.score-a.score)
  records=records.slice(0,5)
  saveRecords()
  location.reload()
}

function update(){
  if(paused) return
  const head={x:(snake[0].x+dir.x+cols)%cols,y:(snake[0].y+dir.y+rows)%rows}
  if(snake.some(p=>p.x===head.x&&p.y===head.y)) return gameOver()
  snake.unshift(head)

  if(head.x===food.x&&head.y===food.y){
    score++
    document.getElementById("score").innerText=score
    spawnFood()
  }else snake.pop()
}

function draw(){
  ctx.fillStyle="#000"
  ctx.fillRect(0,0,320,320)

  ctx.fillStyle="#fff"
  ctx.fillRect(food.x*box+6,food.y*box+6,8,8)

  snake.forEach((p,i)=>{
    ctx.fillStyle=i===0?skins[selectedSkin]:"#ff6b9a"
    ctx.fillRect(p.x*box,p.y*box,box-2,box-2)
  })
}

setInterval(()=>{update();draw()},150)

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp"&&dir.y!==1)dir={x:0,y:-1}
  if(e.key==="ArrowDown"&&dir.y!==-1)dir={x:0,y:1}
  if(e.key==="ArrowLeft"&&dir.x!==1)dir={x:-1,y:0}
  if(e.key==="ArrowRight"&&dir.x!==-1)dir={x:1,y:0}
})

document.getElementById("playBtn").onclick=()=>{
  document.getElementById("startScreen").style.display="none"
  start()
}
</script>

</body>
</html>
